<!DOCTYPE html>
<html lang="en">
<head><script type='text/javascript' src='https://ppl-ai-code-interpreter-files.s3.amazonaws.com/qg1GQiH98B5PcaeG8wvvqYtX3Tc_Fji3MiRO-zEIh7vvQGaA64WgF4CVBezkOif7fvIBS9ZaCyJF-sTFH02Y9lFFGiCpAxKetVXglK2WSG4Wc8LnIrU5uTSQG8ybpAzlYBQF9mcvMTMzFwlzLq8m8VXtdvy1-Ym3uQ8bzZjIDB_Qjz_HCFTD-n8Kk5HcmPey1SYG3se1ePbh-RHthrYn3ElSVLuK2qGxKR6V0iTjjBCtA599jcwt_caKbEu7-Z1T70mAU8DDLH3Q5VQopH0XTCL4Prqo9x0kOuWHDqUB8HtH1H61-vZvIZ9mk6VUiEpzRtYmXHZNHB8MyNSkEe8SYX57WDjTXm2lJiVvpzx6HsWZMaC4nkRA8KwgHFHLResYOcSiOGMaemTTuT63jtGYcJzaLfZwUqG72mcZv0uRjios55YiRh-_UgJC8dCCoFmz9EulTcK9rT_K8HysfJC9gTnVrxK0XigwzeEfyLUEVcHRtVvnVsxqAsyq6ZcUPjUIO7jV_PbqYI38RptW1ZBXhk7TxdUnIPnQ4cgIB8osGn73PazdmzdLFw66l82zg0f3rfbprfsY350pSKc2ZKa3Bk-ccEGRs6OYFuKvcTKB62t18unOF2IByK4iGXXcGjAfoG2vciIXPCE4RMrzL-0XYyBmodvyi-_bjAHqN3lWvYAIqe2lF8q86WxCh8Xjynkp4qJfrzHkxbGD_9ksnaTkmVzkzfZVatt6eNDZzQii8LPEAkgUvM-RLJtLE9EFpMAbQ9j7dC9X71o44ZxaIIfcNlGloXWfFKXmhvcIvDBVo5n27AIHF-g15hx5SoQZ-0PnIU69OOlEYMhk8QAO6EYPnmxQ622WPizbinNYcxXmsdE6-zXIrwLojU29FnqtrJKbNEiueosmWr7FPEoqclFksc9sSGaq9V_D36t6o15UWIcfg3EJqj3wDnpm8z5uPtLOSUWIWVgzWdz4AnAihv6g3gnPC9_uchYKoFuPUy819GdK79ljY9CPw2DjcivRZO4DDIU0eZyfad1vlRlIWTeAno050-Ff-9hDfAEEEKyM_4YvnbhVW5FsbaS2m0zQJQoG3EgFvsVnC3zqiPjoTGR2QCvkTz1K5LSWrNoii5VGB6NBGRZokNYeaXnQl3vqODfSfbwaAI9HqK5WLA6QvZoaQg5WqkR7YtVmy9o_uq87h55pZrUYglKDXk7q5GsG7FFoHJ-s7V5N_pQvMsI9o6zOc5O_YfqWbhB-RfxFvYSG81mXfkp4oRlPAx1C5yeh2cnq37vQ2aSdVZNupwMxvbJBDux1__5RRZt4ohK8QK5hjeIRSAhl9Di1u5pwC2FCkmVo6pTiPz3gguNKjAJKfysnfIsCNIutTM3fewV5yDKiDVRtYOMXV0aoU4Nk3rYW414CHbLbUlFAoW_FYIKR6yN_yj1wnZzuVAbYFp2QIu-5XYx0awFq8nwOn4fo8HEpWofq_3Xp-Ubz6dwSN45VgpRUZANHsLrTxwpdiC7QNDvvEOvxk8Zr_xDFcPn9U-SfnE-vV9cFeFLK1FfmqaOOkNCswktIwUJj8_cNZm7yD7S9d0_mykKOgd_tP1I3-GSPzUIF2rAl-rdHXH1tkijmll6BO_y4znyA2HDYK5o9TA6TigqO2rPCPWDvafxzdj7xZKuDLOXkZ6RDHpJwjCMwSQ7TxNhgX8WTI2Qu_K_jafDJ0Ipm9T-T_EwgGZUvDvnGwk3WDXFegAEyxwYGDdoqYSg8oDFdbP8O4-NoJiwLPDRPep28odw0rgKJ0aNIEANSF1LIDcwdMlUpa7ZRtZMcl1KF4OdF9kXc0TYxaqgcqgSHCUR3otoD6Vgg2o7O-LGX2cq6XZFNjQNNBo-Ecg8rmnYG9KW2xnQbVrvOQlppxErOyYFPBUbIDyky51Hv0g27muSku-I8-urwNFN7mIJol3mtbTLvNWGMBYHn6383sWbueQ1jRZXk_fBLv2o9Q-WXZA9BvLMhS2Mt53bNxY8nX7Xfb9BXP2D3iZk9FOTe1Knr1pIxv6m-lNlow2y8qWnTYor2-cQzGlNqtSBHcXvnDexDKqnK73oRQbgHQvABTPkvv7zoLTQ5GL4i9XCEs78GkmQRsFIE2JSJF2b2SiCaDIh6oDdjYeDT_mkm3IBcdk0S6JzBlk4Rzi3I8-Zu9v3Pm12osIU20feOh8hzCG0PuSK6df4VovhnmMtjfsGppe1-zDO0hD23s0_netFj6V9aR2y27np01FIJuT6ucnL2EJBtaGLwH76gvc9vvscA9c8KUSctF2NK5_3aRePB_iXBtTrnKEgf_EvCKb5pQ485nWcZhsKPPiOxV2YxkO6TSAApl96fTCWvvuwZe3_lHG_P3T114CT_98EbHJVfQeXBxSX190nB1t7iliYnxcW-7MnLwdLdrd60w2ZFcXZGPcxaT_dQycIcZgwjmkVxO2pyRrEpCLmRoo4ANcp3fnLnh9NtV3pwihh9gL8BtogKJ-v_VV0qddoKMsX730CqfzNEXKFoxbarHkndviFtvvXAy7rTIRRpxjtcfv7P1lc1u00f0N4wUtDWUvn9MVs3WwuzhvYOATNDU9YdpgMJ8P83SZZQZahCcV_pVoLrLleepFw5sXiVdOW5K3OwJrb4N_nVjmRPYYzItGCtuHOIRG_h081iVXaofAuUcJvl5tlnWNNYoAQ4euc1xBfsp_O8hx0gW4Q5O557vjXBfszobu0ZHoZn12q9jPQaHx8eJ_4ChLTnq8egIyxG3UUeb8wmPtTdUyj9Zc9LK_bUZBCNYdvEjg'></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Bus Route Auto-Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5em;
        }

        .step-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.2em;
        }

        button {
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            min-width: 200px;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-copy {
            background: #4caf50;
            color: white;
        }

        .btn-copy:hover {
            background: #45a049;
        }

        .btn-download {
            background: #ff9800;
            color: white;
        }

        .btn-download:hover {
            background: #e68900;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.95em;
            font-weight: bold;
        }

        .status-message {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.85em;
            margin-top: 5px;
        }

        .json-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            overflow: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.75em;
            line-height: 1.4;
            max-height: 500px;
            border: 2px solid #667eea;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #667eea;
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #1565c0;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            opacity: 0.8;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 20px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            color: #999;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöå Hong Kong Bus Route Auto-Generator</h1>
            <p>CORS Proxy Method ‚Ä¢ Real-time Fandom Codes ‚Ä¢ 100% Complete</p>
        </div>

        <div class="card">
            <h2><span class="step-badge">‚ö°</span> Final Generator - CORS Method</h2>

            <div class="info-box">
                <p>‚úÖ <strong>Uses CORS proxy (cors.bridged.cc) for Fandom fetch</strong></p>
                <p>‚úÖ <strong>Multiple proxy fallbacks available</strong></p>
                <p>‚úÖ <strong>HTML parsing from Fandom table</strong></p>
                <p>‚úÖ <strong>NO embedded codes ‚Ä¢ 100% online</strong></p>
            </div>

            <button class="btn-primary" onclick="generateAllAutomatic()" id="generateBtn">
                üöÄ Generate All Routes (CORS Method)
            </button>

            <div id="progressContainer" style="display: none; margin-top: 20px;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">Initializing...</div>
                </div>
                <div id="statusMessages" style="max-height: 300px; overflow-y: auto;"></div>
            </div>

            <div class="stats-grid" id="statsContainer" style="display: none; margin-top: 20px;">
                <div class="stat-box">
                    <div class="stat-number" id="statCodes">0</div>
                    <div class="stat-label">Location Codes</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statRoutes">0</div>
                    <div class="stat-label">Routes Fetched</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statMatched">0</div>
                    <div class="stat-label">With Fares</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statGenerated">0</div>
                    <div class="stat-label">JSON Entries</div>
                </div>
            </div>
        </div>

        <!-- Output Section -->
        <div class="card" id="outputCard" style="display: none;">
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('preview')">üìã Full Output</button>
                <button class="tab-button" onclick="switchTab('samples')">üìå Sample Entries</button>
            </div>

            <div id="preview" class="tab-content active">
                <h3 style="margin-bottom: 15px; color: #333;">Complete JSON Array</h3>
                <div class="json-output" id="jsonOutput"></div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn-copy" onclick="copyToClipboard()">üìã Copy All JSON</button>
                    <button class="btn-download" onclick="downloadJSON()">‚¨áÔ∏è Download</button>
                </div>
            </div>

            <div id="samples" class="tab-content">
                <h3 style="margin-bottom: 15px; color: #333;">Sample Entries</h3>
                <h4 style="color: #667eea; margin-bottom: 10px;">Route 1</h4>
                <div class="json-output" id="sampleRoute1"></div>

                <h4 style="color: #667eea; margin-bottom: 10px; margin-top: 20px;">Route 101</h4>
                <div class="json-output" id="sampleRoute101"></div>
            </div>
        </div>

        <div class="footer">
            <p>üöå CORS Proxy Method ‚Ä¢ Multiple Fallbacks ‚Ä¢ Production Ready</p>
        </div>
    </div>

    <script>
        let generatedJSON = null;

        function addStatus(type, message) {
            const container = document.getElementById('statusMessages');
            const div = document.createElement('div');
            div.className = 'status-message status-' + type;
            div.innerHTML = message;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function fetchLocationCodesFromFandom() {
            addStatus('info', 'üåê Loading location codes from Fandom using CORS proxy...');

            const url = 'https://hkbus.fandom.com/wiki/ÂüéÂ∑¥Êñ∞Â∑¥Âú∞Èªû‰ª£ËôüÂàóË°®';

            // Multiple CORS proxies to try
            const proxies = [
                'https://cors.bridged.cc/' + url,
                'https://api.allorigins.win/get?url=' + encodeURIComponent(url),
                'https://corsproxy.io/?' + encodeURIComponent(url)
            ];

            let html = null;
            let lastError = null;

            // Try each proxy
            for (const proxy of proxies) {
                try {
                    addStatus('info', '‚è≥ Trying CORS proxy: ' + proxy.substring(0, 40) + '...');

                    const response = await fetch(proxy, {
                        headers: { 'Accept': 'text/html' },
                        mode: 'cors'
                    });

                    if (!response.ok) {
                        lastError = 'Status ' + response.status;
                        continue;
                    }

                    const data = await response.json();
                    html = data.contents || data.html || data;

                    // Handle nested response format
                    if (typeof html === 'object') {
                        html = JSON.stringify(html);
                    }

                    if (html && html.length > 100) {
                        addStatus('success', '‚úÖ Successfully fetched from CORS proxy');
                        break;
                    }
                } catch (e) {
                    lastError = e.message;
                    addStatus('warning', '‚ö†Ô∏è Proxy attempt failed: ' + e.message);
                    continue;
                }
            }

            if (!html) {
                addStatus('error', '‚ùå All CORS proxies failed: ' + lastError);
                throw new Error('Could not fetch Fandom page: ' + lastError);
            }

            // Parse HTML to extract location codes from tables
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;

            const tables = tempDiv.querySelectorAll('table');
            let codes = {};
            let codesCount = 0;

            tables.forEach(table => {
                const rows = table.querySelectorAll('tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 2) {
                        const code = cells[0].textContent.trim();
                        let stationName = cells[1].textContent.trim();

                        // Clean up station name
                        stationName = stationName
                            .replace(/\[\[/g, '')
                            .replace(/\]\]/g, '')
                            .replace(/ \(/g, '(')
                            .replace(/Ôºà/g, '(')
                            .replace(/Ôºâ/g, ')')
                            .trim();

                        if (code && stationName && code.length <= 3 && /^[A-Z]+$/.test(code)) {
                            codes[code] = stationName;
                            codesCount++;
                        }
                    }
                });
            });

            if (codesCount === 0) {
                throw new Error('No location codes found in parsed HTML');
            }

            addStatus('success', '‚úÖ Loaded ' + codesCount + ' location codes from Fandom');
            return codes;
        }

        function removeSpaceBeforeBracket(text) {
            if (!text) return text;
            return text.replace(/ \(/g, '(').replace(/Ôºà/g, '(').replace(/Ôºâ/g, ')');
        }

        function findLocationCode(name, codes) {
            if (!name) return null;
            const normalized = removeSpaceBeforeBracket(name).trim();

            for (let code in codes) {
                const codeNormalized = removeSpaceBeforeBracket(codes[code]).trim();
                if (codeNormalized === normalized) {
                    return code;
                }
            }
            return null;
        }

        function formatPrice(price) {
            const p = parseFloat(price);
            if (isNaN(p)) return '0.0';
            return p.toFixed(1);
        }

        async function generateAllAutomatic() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span>Processing...';

            document.getElementById('statusMessages').innerHTML = '';
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('statsContainer').style.display = 'grid';

            try {
                // Step 1: Fetch location codes from Fandom using CORS
                document.getElementById('progressFill').textContent = 'üåê Fetching Fandom codes...';
                const locationCodes = await fetchLocationCodesFromFandom();
                document.getElementById('statCodes').textContent = Object.keys(locationCodes).length;

                // Step 2: Fetch routes
                document.getElementById('progressFill').textContent = 'üì° Fetching routes...';
                addStatus('info', '‚è≥ Fetching CTB routes from API...');

                const routesResponse = await fetch('https://rt.data.gov.hk/v2/transport/citybus/route/ctb');
                const routesData = await routesResponse.json();
                const routes = routesData.data || [];

                addStatus('success', '‚úÖ Fetched ' + routes.length + ' routes');
                document.getElementById('statRoutes').textContent = routes.length;

                // Step 3: Fetch fare data
                document.getElementById('progressFill').textContent = 'üí∞ Fetching fares...';
                addStatus('info', '‚è≥ Fetching fares from GitHub...');

                const fareResponse = await fetch('https://raw.githubusercontent.com/hkbus/hk-bus-crawling/gh-pages/routeFareList.min.json');
                const fareData = await fareResponse.json();
                const routeList = fareData.routeList || {};

                const fareMap = {};

                for (const routeKey in routeList) {
                    const route = routeList[routeKey];

                    const keyParts = routeKey.split('+');
                    if (keyParts.length < 4) continue;

                    const routeNum = keyParts[0];
                    const seq = keyParts[1];

                    if (seq !== '1') continue;
                    if (!route.co || !route.co.includes('ctb')) continue;

                    const direction = route.bound && route.bound.ctb ? route.bound.ctb : 'O';
                    const fares = route.fares || [];

                    if (!fares.length) continue;

                    const uniqueFares = [];
                    const seen = {};
                    for (let i = 0; i < fares.length; i++) {
                        const fare = fares[i];
                        if (!seen[fare]) {
                            uniqueFares.push(formatPrice(fare));
                            seen[fare] = true;
                        }
                    }

                    if (!fareMap[routeNum]) {
                        fareMap[routeNum] = {};
                    }
                    fareMap[routeNum][direction] = uniqueFares;
                }

                document.getElementById('statMatched').textContent = Object.keys(fareMap).length;
                addStatus('success', '‚úÖ Loaded fares for ' + Object.keys(fareMap).length + ' routes');

                // Step 4: Generate JSON
                document.getElementById('progressFill').textContent = 'üîÑ Generating JSON...';
                const result = generateJSON(routes, locationCodes, fareMap);
                generatedJSON = result;

                document.getElementById('jsonOutput').textContent = JSON.stringify(result, null, 1);

                for (let i = 1; i < result.length; i++) {
                    if (result[i].route === '1') {
                        document.getElementById('sampleRoute1').textContent = JSON.stringify(result[i], null, 2);
                        break;
                    }
                }

                for (let i = 1; i < result.length; i++) {
                    if (result[i].route === '101') {
                        document.getElementById('sampleRoute101').textContent = JSON.stringify(result[i], null, 2);
                        break;
                    }
                }

                document.getElementById('outputCard').style.display = 'block';
                document.getElementById('statGenerated').textContent = result.length;

                document.getElementById('progressFill').textContent = '‚úÖ Complete!';
                addStatus('success', '‚úÖ Generated ' + result.length + ' complete entries!');

            } catch (error) {
                addStatus('error', '‚ùå Error: ' + error.message);
                console.error(error);
            }

            btn.disabled = false;
            btn.innerHTML = '‚úÖ Generated! Click to refresh';
        }

        function generateJSON(routes, codes, fareMap) {
            const results = [{
                number: 0,
                route: 'CTB',
                destZ: 'Êö´ÂÅúÊúçÂãô',
                engdestZ: 'Not In Service',
                destY: 'Êö´ÂÅúÊúçÂãô',
                engdestY: 'Not In Service',
                maxPZ: '1',
                priceZ1: '0.0',
                halfpriceZ1: '0.0',
                maxPY: '1',
                priceY1: '0.0',
                halfpriceY1: '0.0'
            }];

            for (let idx = 0; idx < routes.length; idx++) {
                const route = routes[idx];
                const routeNum = route.route;

                const destTc = removeSpaceBeforeBracket(route.dest_tc || '');
                const origTc = removeSpaceBeforeBracket(route.orig_tc || '');

                const destCode = findLocationCode(destTc, codes);
                const origCode = findLocationCode(origTc, codes);

                const destZ = destCode ? destCode + ' ' + destTc : destTc;
                const destY = origCode ? origCode + ' ' + origTc : origTc;

                let faresZ = [];
                let faresY = [];

                if (fareMap[routeNum]) {
                    faresZ = fareMap[routeNum]['O'] || [];
                    faresY = fareMap[routeNum]['I'] || [];
                }

                const entry = {
                    number: results.length,
                    route: routeNum,
                    destZ: destZ,
                    engdestZ: route.dest_en,
                    destY: destY,
                    engdestY: route.orig_en,
                    maxPZ: faresZ.length.toString(),
                    maxPY: faresY.length.toString()
                };

                for (let i = 0; i < faresZ.length; i++) {
                    entry['priceZ' + (i + 1)] = faresZ[i];
                    const halfPrice = (parseFloat(faresZ[i]) / 2).toFixed(1);
                    entry['halfpriceZ' + (i + 1)] = halfPrice;
                }

                for (let i = 0; i < faresY.length; i++) {
                    entry['priceY' + (i + 1)] = faresY[i];
                    const halfPrice = (parseFloat(faresY[i]) / 2).toFixed(1);
                    entry['halfpriceY' + (i + 1)] = halfPrice;
                }

                results.push(entry);
            }

            return results;
        }

        function copyToClipboard() {
            if (!generatedJSON) return;
            const text = JSON.stringify(generatedJSON, null, 2);
            navigator.clipboard.writeText(text).then(() => {
                addStatus('success', '‚úÖ Copied to clipboard!');
            });
        }

        function downloadJSON() {
            if (!generatedJSON) return;
            const text = JSON.stringify(generatedJSON, null, 2);
            const date = new Date().toISOString().split('T')[0];
            const element = document.createElement('a');
            element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', 'ctb_all_routes_' + date + '.json');
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            addStatus('success', '‚úÖ JSON downloaded!');
        }
    </script>
</body>
</html>
